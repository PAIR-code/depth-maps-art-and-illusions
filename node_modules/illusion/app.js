var Illusion = require('./illusion/illusion');

var illusion = new Illusion();

var googleTask = illusion.registerTask('GoogleTask', 'http://www.google.com');
googleTask.getURL('GetURL');
googleTask.getTitle('GetTitle');
googleTask.openPage('OpenPage', 'http://www.sina.com.cn', [ 'GetURL', 'GetTitle']);

var baiduTask = illusion.registerTask('BaiduTask', 'http://www.baidu.com');
baiduTask.getURL('GetURL');
baiduTask.getTitle('GetTitle');
baiduTask.openPage('OpenPage', 'http://www.sina.com.cn', [ 'GetURL', 'GetTitle']);

illusion.init('./cookies', function() {
    illusion.run([ 'GoogleTask', 'BaiduTask' ]);
});

illusion.on('stepDone', function(task, step) {
    console.log(task.name + ' ' + step.name + ' done.');
    if (task.name === 'GoogleTask') {
        if (step.name === 'GetURL') {
            console.log('Google URL is: ' + arguments[2]);
        }
    }
});

illusion.on('taskDone', function(task) {
    console.log(task.name + ' done.');
});

illusion.on('allTasksDone', function() {
    console.log('All tasks done!');
    illusion.cleanup('./cookies.json');
});